<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<!-- 环境变量 -->
	<bean id="context" class="nc.ui.bd.defdoc.DefdocLoginContext"></bean>

	<!-- 模型部分配置 -->

	<!-- 应用服务类，负责进行模型操作的处理 -->
	<bean id="modelService" class="nc.ui.bm.item.model.BmitemModelService"/>

	<!-- 对象转换器工厂，由此获取操作对象的特征信息 -->
	<bean id="boadatorfactory" class="nc.vo.bd.meta.BDObjectAdpaterFactory"/>

	<!-- 层次应用模型 -->
	<bean id="appModel" class="nc.ui.bm.item.model.BmitemAppModel">
		<property name="service">
			<ref bean="modelService" />
		</property>
		<property name="businessObjectAdapterFactory">
			<ref bean="boadatorfactory" />
		</property>
		<property name="context">
			<ref bean="context" />
		</property>
	</bean>

	<!-- 数据模型管理器，主要负责各种方式的模型初始化 -->
	<bean id="modelDataManager" class="nc.ui.bm.item.model.BmitemModelDataManager">
		<property name="model" ref="appModel"></property>
		<property name="service" ref="modelService"></property>
		<property name="context" ref="context"></property>
		<property name="typeField" value="category_id"/>
	</bean>

	<!-- 模板容器，负责对模板的统一装载 -->
	<bean id="templateContainer" class="nc.ui.uif2.editor.TemplateContainer"  init-method="load">

		<property name="context" ref="context"/>
		<property name="nodeKeies">
			<list>
				<value>bmitem</value>
			</list>
		</property>
	</bean>
	<bean id="toftpanelActionContributors" class="nc.ui.uif2.actions.ActionContributors">
		<property name="contributors">
			<list>
				<ref bean="listViewActions"/>
				<ref bean="cardEditorActions"/>
			</list>
		</property>
	</bean>
	<bean id="queryDelegator" class="nc.ui.hr.uif2.HrQueryDelegator">

		<property name="nodeKey" value="bmitem" />
		<property name="context" ref="context" />
	</bean>

	<!-- 界面元素 -->
	<!--树控件 nc.ui.uif2.components.TreePanel-->

	<!-- 层次结构构造策略
	<bean id="treeCreateStrategy" class="nc.vo.bd.meta.BDObjectTreeCreateStrategy">
	<property name="factory" ref="boadatorfactory"/>
	<property name="rootName">
	<bean class="nc.ui.uif2.I18nFB">
	<property name="resDir" value="xmlcode" />
	<property name="defaultValue" value="项目分类" />
	<property name="resId" value="X60130003" />
	</bean>
	</property>
	</bean> -->

	<!-- 层次结构构造策略-->
	<bean id="treeCreateStrategy" class="nc.vo.bd.meta.BDObjectTreeCreateStrategy">
		<property name="factory" ref="boadatorfactory"/>
		<property name="rootName" >
			<bean class="nc.ui.uif2.I18nFB">
				<property name="resDir" value="xmlcode" />
				<property name="defaultValue" value="项目分类" />
				<property name="resId" value="X60150001" />
			</bean>
		</property>
	</bean>
	<bean id="treeModelService" class="nc.ui.bd.defdoc.DefdocAppService">

		<property name="context" ref="context"/>
	</bean>
	<bean id="InitDataListener"
	class="nc.ui.bm.item.model.BmItemDefdocSingleNodeDataManager">
		<property name="model" ref="HAppModel"></property>
		<property name="context" ref="context" />
		<property name="service" ref="treeModelService" />
	</bean>

	<!-- 层次应用模型 -->
	<bean id="HAppModel" class="nc.ui.bm.item.model.BmItemHierachicalDataAppModel">

		<property name="service">

			<ref bean="treeModelService" />
		</property>
		<property name="treeCreateStrategy">
			<ref bean="treeCreateStrategy" />
		</property>
		<property name="businessObjectAdapterFactory">
			<ref bean="boadatorfactory" />
		</property>
		<property name="context">
			<ref bean="context" />
		</property>
	</bean>
	<bean id="treePanel" class="nc.ui.hr.uif2.view.HrTreePanel" init-method="initUI">
		<property name="model" ref="HAppModel"/>
		<property name="rootvisibleflag" value="true"/>

	</bean>
	<bean id="typeAndDocMediator" class="nc.ui.hr.uif2.mediator.TypeAndDocMediator">
		<property name="typeModel" ref="HAppModel"/>
		<property name="docModel" ref="appModel"/>
		<property name="docModelDataManager" ref="modelDataManager"/>
	</bean>

	<!--卡控件-->
	<bean id="billListView" class="nc.ui.bm.item.view.BmitemListView" init-method="initUI">
		<property name="model" ref="appModel"></property>
		<property name="templateContainer" ref="templateContainer"/>
		<property name="nodekey" value="bmitem"></property>
	</bean>
	<bean id="defaultValueProvider" class="nc.ui.bm.item.model.BmItemDefaultValueProvider">
		<property name="modelDataManager" ref="modelDataManager"/>
	</bean>
	<bean id="billFormEditor" class="nc.ui.bm.item.view.BmitemCardForm" init-method="initUI">
		<property name="model" ref="appModel"></property>
		<property name="templateContainer" ref="templateContainer"/>
		<property name="nodekey" value="bmitem"/>
		<!-- <property name="actions">
		<list>

		<ref bean="firstLineAction"/>
		<ref bean="preLineAction"/>
		<ref bean="nextLineAction"/>
		<ref bean="lastLineAction"/>
		</list>
		</property> -->
	</bean>

	<!-- Actions -->

	<!-- 节点级Action -->
	<bean id="AddAction" class="nc.ui.bm.item.action.AddBmitemAction">

		<property name="model" ref="appModel"/>
		<property name="defaultValueProvider" ref="defaultValueProvider" />
		<property name="formEditor" ref="billFormEditor"/>
		<!--		<property name="interceptor" ref="AddActionInteceptor"/>-->

	</bean>

	<!--   	<bean id="AddActionInteceptor" class="nc.ui.bm.item.action.AddBmitemInterceptor" >-->
	<!--   	            <property name="model" ref="appModel"></property>-->
	<!--   	</bean>-->
	<bean id="SaveAddItemAction" class="nc.ui.bm.item.action.SaveAddBmitemAction">
		<property name="model" ref="appModel"/>
		<property name="addAction" ref="AddAction"/>
		<property name="saveAction" ref="SaveAction"/>
	</bean>
	<bean id="EditAction" class="nc.ui.bm.item.action.EditBmitemAction">
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="DeleteAction" class="nc.ui.bm.item.action.DeleteBmitemAction">
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="QueryAction" class="nc.ui.bm.item.action.QueryBmitemAction">
		<property name="model" ref="appModel"/>
		<property name="queryDelegator" ref="queryDelegator"></property>
		<property name="dataManager" ref="modelDataManager"></property>
	</bean>
	<bean id="RefreshAction" class="nc.ui.bm.item.action.RefreshBmitemAction">
		<property name="model" ref="appModel"/>
		<property name="dataManager" ref="modelDataManager"></property>
	</bean>
	<bean id="billNotNullValidator" class="nc.ui.hr.uif2.validator.BillNotNullValidateService">
		<constructor-arg ref="billFormEditor"></constructor-arg>
		<property name="nextValidateService">
			<bean class="nc.ui.bm.item.validator.BmitemCustomValidator"/>
		</property>
	</bean>
	<bean id="SaveAction" class="nc.ui.bm.item.action.SaveBmitemAction">
		<property name="model" ref="appModel"/>
		<property name="editor" ref="billFormEditor"/>
		<property name="validationService" ref="billNotNullValidator"></property>
		<property name="interceptor"  ref="SaveBmItemInterceptor"></property>

	</bean>
	<bean id="SaveBmItemInterceptor"  class="nc.ui.bm.item.action.SaveBmItemInterceptor">
		<property name="model" ref="appModel"></property>
		<property name="container" ref="billListView"></property>
	</bean>
	<bean id="SaveAddAction" class="nc.ui.bm.item.action.SaveAddBmitemAction">
		<property name="model" ref="appModel"/>
		<property name="validationService" ref="customValidator"></property>
		<property name="addAction" ref="AddAction"></property>
		<property name="saveAction" ref="SaveAction"/>
	</bean>
	<bean id="CancelAction" class="nc.ui.bm.item.action.CancelBmitemAction">
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="PrintGroupAction" class="nc.funcnode.ui.action.GroupAction">

		<property name="code" value="print"></property>
		<property name="name">
			<bean class="nc.ui.uif2.I18nFB">

				<property name="resDir" value="xmlcode" />
				<property name="defaultValue" value="打印" />
				<property name="resId" value="X60150002" />
			</bean>
		</property>
		<property name="actions">
			<list>

				<ref bean="PrintAction" />
				<ref bean="PreviewAction" />
				<ref bean="exportListAction"/>
			</list>
		</property>

	</bean>
	<bean id="datasource" class="nc.ui.hr.uif2.model.HRMetaDataDataSource">
		<property name="model" ref="appModel" />
		<property name="singleData" value="true"/>
	</bean>
	<bean id="TemplatePreviewAction" class="nc.ui.hr.uif2.action.print.TemplatePreviewAction">
		<property name="model" ref="appModel" />
		<property name="printDlgParentConatiner" ref="billListView" />
		<property name="datasource" ref="datasource" />
	</bean>
	<bean id="TemplatePrintAction" class="nc.ui.hr.uif2.action.print.TemplatePrintAction">
		<property name="model" ref="appModel" />
		<property name="printDlgParentConatiner" ref="billListView" />
		<property name="datasource" ref="datasource" />
	</bean>
	<bean id="FirstLineAction" class="nc.ui.uif2.actions.FirstLineAction">
		<property name="model" ref="appModel" />
	</bean>
	<bean id="NextLineAction" class="nc.ui.uif2.actions.NextLineAction">
		<property name="model" ref="appModel" />
	</bean>
	<bean id="PreLineAction" class="nc.ui.uif2.actions.PreLineAction">
		<property name="model" ref="appModel" />
	</bean>
	<bean id="LastLineAction" class="nc.ui.uif2.actions.LastLineAction">
		<property name="model" ref="appModel" />
	</bean>
	<bean id="nullaction" class="nc.funcnode.ui.action.SeparatorAction" />

	<!-- 页签级Action -->
	<!-- 主表 -->

	<!-- 子表 -->

	<!-- Validator -->
	<bean id="customValidator" class="nc.ui.bm.item.validator.BmitemCustomValidator"></bean>

	<!-- ClosingListener -->
	<bean id="ClosingListener" class="nc.ui.uif2.FunNodeClosingHandler">
		<property name="model" ref="appModel" />
		<property name="saveaction" ref="SaveAction" />
		<property name="cancelaction" ref="CancelAction" />

	</bean>

	<!-- 界面零件 -->
	<bean id="orgpanel" class="nc.ui.hr.uif2.view.PrimaryOrgPanel" init-method="initUI">
		<property name="model" ref="appModel" />
		<property name="dataManager" ref="modelDataManager" />
		<property name="pk_orgtype" value="HRORGTYPE00000000000" />

	</bean>
	<bean id="editorReturnAction" class="nc.ui.uif2.actions.ShowMeUpAction">
		<property name="goComponent" ref="billListView" />
	</bean>
	<bean id="editorToolBarPanel" class="nc.ui.uif2.tangramlayout.CardLayoutToolbarPanel">
		<property name="model" ref="appModel" />
		<property name="titleAction" ref="editorReturnAction" />
		<property name="actions">
			<list>
				<ref bean="firstLineAction" />
				<ref bean="preLineAction" />
				<ref bean="nextLineAction" />
				<ref bean="lastLineAction" />
			</list>
		</property>
	</bean>
	<bean id="firstLineAction" class="nc.ui.uif2.actions.FirstLineAction">
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="preLineAction" class="nc.ui.uif2.actions.PreLineAction">
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="nextLineAction" class="nc.ui.uif2.actions.NextLineAction">
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="lastLineAction" class="nc.ui.uif2.actions.LastLineAction">
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="PreviewAction" class="nc.ui.hr.uif2.action.print.DirectPreviewAction">
		<property name="model" ref="appModel" />
		<property name="listView" ref="billListView" />
	</bean>
	<bean id="PrintAction" class="nc.ui.hr.uif2.action.print.DirectPrintAction">
		<property name="model" ref="appModel" />
		<property name="listView" ref="billListView" />
	</bean>
	<bean id="exportListAction" class="nc.ui.hr.uif2.action.print.ExportListAction">
		<property name="model" ref="appModel" />
		<property name="listView" ref="billListView" />
	</bean>

	<!-- Actions -->
	<bean id="cardEditorActions" class="nc.ui.uif2.actions.StandAloneToftPanelActionContainer">
		<constructor-arg>
			<ref bean="billFormEditor" />
		</constructor-arg>
		<property name="actions">
			<list>
				<ref bean="AddAction"/>
				<ref bean="EditAction"/>
				<ref bean="DeleteAction"/>
				<ref bean="nullaction" />
				<!-- <ref bean="refreshSingleAction"/> -->

			</list>
		</property>
		<property name="editActions">
			<list>
				<ref bean="SaveAction"/>
				<ref bean="SaveAddAction"/>
				<ref bean="nullaction" />
				<ref bean="CancelAction"/>
			</list>
		</property>
		<property name="model" ref="appModel"/>
	</bean>
	<bean id="listViewActions" class="nc.ui.uif2.actions.StandAloneToftPanelActionContainer">
		<constructor-arg>
			<ref bean="billListView"/>
		</constructor-arg>
		<property name="actions">
			<list>
				<ref bean="AddAction"/>
				<ref bean="EditAction"/>
				<ref bean="DeleteAction"/>
				<ref bean="nullaction" />
				<ref bean="RefreshAction"/>
				<ref bean="nullaction" />
				<!-- <ref bean="PrintGroupListAction"/>-->
				<ref bean="nullaction" />
				<!-- <ref bean="displayAction" />-->
				<ref bean="PrintGroupAction" />
			</list>
		</property>
	</bean>

	<!-- 界面布局总装 -->
	<bean id="container" class="nc.ui.uif2.TangramContainer" init-method="initUI">
		<property name="tangramLayoutRoot">
			<bean class="nc.ui.uif2.tangramlayout.node.TBNode">
				<property name="showMode" value="CardLayout" />
				<property name="tabs">
					<list>
						<bean class="nc.ui.uif2.tangramlayout.node.VSNode">
							<property name="showMode" value="NoDivider" />
							<property name="up">
								<bean class="nc.ui.uif2.tangramlayout.node.CNode">
									<property name="component" ref="orgpanel" />
								</bean>
							</property>
							<property name="down">
								<bean class="nc.ui.uif2.tangramlayout.node.HSNode">
									<property name="left">

										<bean class="nc.ui.uif2.tangramlayout.node.TBNode">
											<property name="tabs">
												<list>
													<bean class="nc.ui.uif2.tangramlayout.node.CNode">
														<property name="name" >
															<bean class="nc.ui.uif2.I18nFB">
																<property name="resDir" value="xmlcode" />
																<property name="defaultValue" value="项目分类" />
																<property name="resId" value="X60150001" />
															</bean>
														</property>
														<property name="component" ref="treePanel"></property>
													</bean>
												</list>
											</property>
										</bean>
									</property>
									<property name="right">
										<bean class="nc.ui.uif2.tangramlayout.node.CNode">
											<property name="component" ref="billListView" />
										</bean>
									</property>
									<property name="dividerLocation" value="0.2f" />
								</bean>
							</property>
							<property name="dividerLocation" value="30f" />
						</bean>
						<bean class="nc.ui.uif2.tangramlayout.node.VSNode">
							<property name="showMode" value="NoDivider" />
							<property name="up">
								<bean class="nc.ui.uif2.tangramlayout.node.CNode">
									<property name="component" ref="editorToolBarPanel" />
								</bean>
							</property>
							<property name="down">
								<bean class="nc.ui.uif2.tangramlayout.node.CNode">
									<property name="component" ref="billFormEditor" />
								</bean>
							</property>
							<property name="dividerLocation" value="26f" />
						</bean>
					</list>
				</property>
			</bean>
		</property>
	</bean>
	<!-- 超链接  -->
	<bean id="mouseClickShowPanelMediator" class="nc.ui.hr.uif2.mediator.HyperLinkClickMediator">
		<property name="model" ref="appModel"/>
		<property name="showUpComponent" ref="billFormEditor"/>
		<property name="hyperLinkColumn" value="code"/>
	</bean>
</beans>
